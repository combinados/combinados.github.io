"use strict";angular.module("bolao.carrossel",[]).directive("carrossel",["BD","$timeout",function(a,o){return{restrict:"E",transclude:"true",replace:"true",templateUrl:"components/carrossel/diretivas/diretiva-carrossel.html",scope:{totalPaginas:"=",boleiro:"="},controller:["$scope",function(e){e.direcao="esquerda",e.paginas=[];var i=this,t=1,r=function(a){angular.forEach(e.paginas,function(o){return o.conteudo.id===a?void o.exibir():void 0})};e.atualizarPagina=function(i,n){e.direcao=void 0===n?t>=i?"esquerda":"direita":n;var l=!0,s=!1;angular.forEach(e.paginas,function(a){a.conteudo.id===t&&(a.ocultar(),s=!0),a.conteudo.id===i&&(l=!1),!l&&s}),l&&e.boleiro.rodadas.push(a.pegarRodada(e.boleiro.id,i)),o(function(){r(i)},100),t=i},e.ehPaginaAtual=function(a){return t===a},e.proximaPagina=function(){var a=t,o=a<e.totalPaginas?++a:1;e.atualizarPagina(o,"direita")},e.paginaAnterior=function(){var a=t,o=a>1?--a:e.totalPaginas;e.atualizarPagina(o,"esquerda")},i.adicionarPagina=function(a){1===t&&a.exibir(),e.paginas.push(a)}}]}}]).directive("pagina",function(){return{require:"^carrossel",restrict:"E",transclude:"true",replace:"true",scope:{conteudo:"="},link:function(a,o,e,i){a.exibir=function(){a.visivel=!0,a.detalheVisivel=!0},a.ocultar=function(){a.visivel=!1,a.detalheVisivel=!1},a.alternarDetalhe=function(){a.detalheVisivel=!a.detalheVisivel},a.ocultar(),i.adicionarPagina(a)},templateUrl:"components/carrossel/diretivas/diretiva-paginas.html"}}),angular.module("bolao.acordeon",[]).directive("acordeon",function(){return{restrict:"E",transclude:"true",replace:"true",templateUrl:"components/acordeon/diretivas/diretiva-acordeon.html",scope:"true",controller:["$scope",function(a){a.itens=[];var o=this,e=2,i=0,t=0,r=0,n=0,l=2,s=0,c=0,d=function(o){e>n&&(0===i||i>=o.boleiro.pontos)?(o.tipo="item-premiado",n++,i=o.boleiro.pontos):i<o.boleiro.pontos?(angular.forEach(a.itens,function(a){a.boleiro.pontos===i&&(a.tipo="")}),i=o.boleiro.pontos,o.tipo="item-premiado"):i===o.boleiro.pontos?angular.forEach(a.itens,function(a){a.boleiro.pontos===i&&(o.boleiro.placares>a.boleiro.placares?(a.tipo="",o.tipo="item-premiado"):o.boleiro.placares===a.boleiro.placares&&(o.tipo="item-premiado"))}):(o.tipo="",u(o))},u=function(o){if(console.log("Entrada: 	PT = 	"+o.boleiro.pontos+"	PL = 	"+o.boleiro.placares+"	Tipo = "+o.tipo+"\nminPT = "+t+"	minPL = "+r+"	Rebaixados = "+s),l>s)o.tipo="item-rebaixado",s++,0===t?(t=o.boleiro.pontos,r=o.boleiro.placares):t<o.boleiro.pontos?(t=o.boleiro.pontos,r=o.boleiro.placares):t===o.boleiro.pontos&&(r<o.boleiro.placares&&(r=o.boleiro.placares),r===o.boleiro.placares&&s--);else if(t>=o.boleiro.pontos){var e=!1,i=o.boleiro.pontos,n=o.boleiro.placares;angular.forEach(a.itens,function(a){"item-rebaixado"===a.tipo&&(a.boleiro.pontos===t&&(a.boleiro.pontos>o.boleiro.pontos||a.boleiro.pontos===o.boleiro.pontos&&a.boleiro.placares>o.boleiro.placares)&&(a.tipo="",e=!0,o.tipo="item-rebaixado"),"item-rebaixado"===a.tipo&&(a.boleiro.pontos>i||a.boleiro.pontos===i&&a.boleiro.placares>n)&&(i=a.boleiro.pontos,n=a.boleiro.placares))}),e&&s--,t=i,r=n}console.log("Saída: 	PT = 	"+o.boleiro.pontos+"	PL = 	"+o.boleiro.placares+"	Tipo = "+o.tipo+"\nminPT = "+t+"	minPL = "+r+"	Rebaixados = "+s)};o.adicionarItem=function(o){o.tipo="premiado",d(o),a.itens.push(o)},o.abrir=function(o){o===c?a.itens[c].visivel?a.itens[o].ocultar():a.itens[o].exibir():(a.itens[c].ocultar(),a.itens[o].exibir()),c=o}}]}}).directive("item",["BD",function(a){return{require:"^acordeon",restrict:"E",transclude:"true",replace:"true",scope:{boleiro:"=",indice:"@"},link:function(o,e,i,t){o.direcao="esquerda",o.exibir=function(){o.visivel=!0,o.situacao="item-aberto"},o.abrir=function(e){var i=o.boleiro.rodadas;"object"==typeof i&&i instanceof Array&&(i.length||o.boleiro.rodadas.push(a.pegarRodada(o.boleiro.id,1))),t.abrir(e)},o.ocultar=function(){o.visivel=!1,o.situacao="item-fechado"},o.ocultar(),t.adicionarItem(o)},templateUrl:"components/acordeon/diretivas/diretiva-item.html"}}]),angular.module("bolao",["bolao.carrossel","bolao.acordeon","ngTouch"]),angular.module("bolao").factory("BD",["$http","$templateCache",function(a,o){var e,i,t="bd.json",r=function(a){return"Gabarito"!==a.nome?n(a):void(i=a)},n=function(a){for(var o=null,e=0;e<a.rodadas.length;e++){o=a.rodadas[e];for(var t=0;t<o.jogos.length;t++){var r=o.jogos[t],n=i.rodadas[e].jogos[t];r.pontos=l(r,n),o.pontos+=r.pontos}}a.pontos=a.rodadas.reduce(function(a,o){return a+o.pontos},0);for(var s=0;s<a.rodadas.length;s++){var c=a.rodadas[s].jogos.filter(function(a){return 3===a.pontos?a:void 0});a.placares+=a.rodadas[s].placares=c.length}var d=a.rodadas.filter(function(a){return a.pontos>0}).length;return a.mediaPontos=a.pontos/d,a.mediaPlacares=a.placares/d,a.totalRodadas=a.rodadas.length,a},l=function(a,o){return""===o.mandante.gols||""===o.visitante.gols||""===a.mandante.gols||""===a.visitante.gols?0:o.mandante.gols===a.mandante.gols&&o.visitante.gols===a.visitante.gols?3:o.mandante.gols===o.visitante.gols&&a.mandante.gols===a.visitante.gols||o.mandante.gols<o.visitante.gols&&a.mandante.gols<a.visitante.gols||o.mandante.gols>o.visitante.gols&&a.mandante.gols>a.visitante.gols?1:0},s=function(a){return angular.extend(c(a.id),a),a.rodadas=[],a},c=function(a){var o=e.filter(function(o){return o.id===a?o:void 0});return o[0]},d=function(a,o){for(var e=0;e<o.length;e++)if(o[e].id===a)return o[e]};return{pegarBoleiros:function(){return a({method:"GET",url:t,cache:o,headers:{"X-Api-Secret":"xxx",Authorization:"xxx","Content-Type":"undefined"}}).then(function(a){e=a.data;var o=JSON.parse(JSON.stringify(a.data));return o.filter(r).map(s)})},pegarRodada:function(a,o){var e=c(a);return d(o,e.rodadas)}}}]),angular.module("bolao").controller("NavbarCtrl",["$scope",function(a){a.date=new Date}]),angular.module("bolao").controller("ControlePrincipal",["$scope","BD",function(a,o){a.boleiros=[],o.pegarBoleiros().then(function(o){a.boleiros=o})}]),angular.module("bolao").run(["$templateCache",function(a){a.put("components/navbar/navbar.html",'<nav class="navbar" ng-controller="NavbarCtrl"><a href="https://github.com/Swiip/generator-gulp-angular">Gulp Angular</a><ul><li class="active"><a ng-href="#">Home</a></li><li><a ng-href="#">About</a></li><li><a ng-href="#">Contact</a></li></ul><ul><li><a ng-href="#">Current date: {{ date | date:\'yyyy-MM-dd\' }}</a></li></ul></nav>'),a.put("components/acordeon/diretivas/diretiva-acordeon.html",'<div class="acordeon" ng-transclude=""></div>'),a.put("components/acordeon/diretivas/diretiva-item.html",'<div class="item {{situacao}}"><div class="item-cabecalho {{situacao}} {{tipo}}" ng-click="abrir(indice)"><figure><img ng-src="{{boleiro.foto}}"> <img ng-src="{{boleiro.campeao.escudo}}"><figcaption>Meu campeão: {{boleiro.campeao.pontos}} pontos</figcaption></figure><div class="nome">{{boleiro.nome}}</div><div class="valores">Pontos<br>{{boleiro.pontos}}</div><div class="valores">Placares<br>{{boleiro.placares}}</div></div><div ng-transclude=""></div></div>'),a.put("components/carrossel/diretivas/diretiva-carrossel.html",'<div class="carrossel"><nav class="navegacao"><ul class="pontos"><li class="ponto" ng-class="{\'ativo\':ehPaginaAtual($index + 1)}" ng-repeat="pagina in (0|number:totalPaginas - 2 ) track by $index" ng-click="atualizarPagina($index + 1);">{{$index + 1}}</li></ul></nav><div ng-transclude="" class="paginas {{direcao}}" ng-swipe-left="paginaAnterior()" ng-swipe-right="proximaPagina()"></div><a class="seta anterior" ng-click="paginaAnterior()"></a> <a class="seta proxima" ng-click="proximaPagina()"></a></div>'),a.put("components/carrossel/diretivas/diretiva-paginas.html",'<div class="pagina" ng-hide="!visivel"><div class="conteudo" ng-transclude="" ng-click="alternarDetalhe()"></div><div ng-click="alternarDetalhe()" class="detalhe" ng-class="{ocultar : !detalheVisivel}"><table class="detalhe-rodada"><tr><td class="cabecalho-detalhe-rodada" colspan="4">Detalhes da Rodada</td></tr><tr><td class="esquerda">Número:</td><td class="esquerda">{{conteudo.id}}</td><td class="esquerda">Total de Pontos:</td><td class="direita">{{conteudo.pontos}}</td></tr><tr><td class="esquerda">Data:</td><td class="esquerda">{{conteudo.data | date : \'dd/MM/yyyy\'}}</td><td class="esquerda">Total de Placares:</td><td class="direita">{{conteudo.Placares}}</td></tr></table></div></div>')}]);
