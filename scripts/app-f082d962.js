"use strict";angular.module("bolao.carrossel",[]).directive("carrossel",["BD","$timeout",function(a,e){return{restrict:"E",transclude:"true",replace:"true",templateUrl:"components/carrossel/diretivas/diretiva-carrossel.html",scope:{totalPaginas:"=",boleiro:"="},controller:["$scope",function(t){t.direcao="esquerda",t.paginas=[];var o=this,i=1,r=function(a){angular.forEach(t.paginas,function(e){return e.conteudo.id===a?void e.exibir():void 0})};t.atualizarPagina=function(o,n){t.direcao=void 0===n?i>=o?"esquerda":"direita":n;var s=!0,l=!1;angular.forEach(t.paginas,function(a){a.conteudo.id===i&&(a.ocultar(),l=!0),a.conteudo.id===o&&(s=!1),!s&&l}),s&&t.boleiro.rodadas.push(a.pegarRodada(t.boleiro.id,o)),e(function(){r(o)},100),i=o},t.ehPaginaAtual=function(a){return i===a},t.proximaPagina=function(){var a=i,e=a<t.totalPaginas?++a:1;t.atualizarPagina(e,"direita")},t.paginaAnterior=function(){var a=i,e=a>1?--a:t.totalPaginas;t.atualizarPagina(e,"esquerda")},o.adicionarPagina=function(a){1===i&&a.exibir(),t.paginas.push(a)}}]}}]).directive("pagina",function(){return{require:"^carrossel",restrict:"E",transclude:"true",replace:"true",scope:{conteudo:"="},link:function(a,e,t,o){a.exibir=function(){a.visivel=!0,a.detalheVisivel=!0},a.ocultar=function(){a.visivel=!1,a.detalheVisivel=!1},a.alternarDetalhe=function(){a.detalheVisivel=!a.detalheVisivel},a.ocultar(),o.adicionarPagina(a)},templateUrl:"components/carrossel/diretivas/diretiva-paginas.html"}}),angular.module("bolao.acordeon",[]).directive("acordeon",function(){return{restrict:"E",transclude:"true",replace:"true",templateUrl:"components/acordeon/diretivas/diretiva-acordeon.html",scope:"true",controller:["$scope",function(a){var e=this,t=0;a.itens=[],e.adicionarItem=function(e){e.tipo="premiado",a.itens.push(e)},e.abrir=function(e){e===t?a.itens[t].visivel?a.itens[e].ocultar():a.itens[e].exibir():(a.itens[t].ocultar(),a.itens[e].exibir()),t=e}}]}}).directive("item",["BD",function(a){return{require:"^acordeon",restrict:"E",transclude:"true",replace:"true",scope:{boleiro:"=",indice:"@"},link:function(e,t,o,i){e.direcao="esquerda",e.exibir=function(){e.visivel=!0,e.situacao="item-aberto"},e.abrir=function(t){var o=e.boleiro.rodadas;"object"==typeof o&&o instanceof Array&&(o.length||e.boleiro.rodadas.push(a.pegarRodada(e.boleiro.id,1))),i.abrir(t)},e.ocultar=function(){e.visivel=!1,e.situacao="item-fechado"},e.ocultar(),i.adicionarItem(e)},templateUrl:"components/acordeon/diretivas/diretiva-item.html"}}]),angular.module("bolao",["bolao.carrossel","bolao.acordeon"]),angular.module("bolao").factory("BD",["$http","$templateCache",function(a,e){var t,o,i="bd.json",r=function(a){return"Gabarito"!==a.nome?n(a):void(o=a)},n=function(a){for(var e=null,t=0;t<a.rodadas.length;t++){e=a.rodadas[t];for(var i=0;i<e.jogos.length;i++){var r=e.jogos[i],n=o.rodadas[t].jogos[i];r.pontos=s(r,n),e.pontos+=r.pontos}}a.pontos=a.rodadas.reduce(function(a,e){return a+e.pontos},0);for(var l=0;l<a.rodadas.length;l++){var d=a.rodadas[l].jogos.filter(function(a){return 3===a.pontos?a:void 0});a.placares+=a.rodadas[l].placares=d.length}var c=a.rodadas.filter(function(a){return a.pontos>0}).length;return a.mediaPontos=a.pontos/c,a.mediaPlacares=a.placares/c,a.totalRodadas=a.rodadas.length,a},s=function(a,e){return""===e.mandante.gols||""===e.visitante.gols||""===a.mandante.gols||""===a.visitante.gols?0:e.mandante.gols===a.mandante.gols&&e.visitante.gols===a.visitante.gols?3:e.mandante.gols===e.visitante.gols&&a.mandante.gols===a.visitante.gols||e.mandante.gols<e.visitante.gols&&a.mandante.gols<a.visitante.gols||e.mandante.gols>e.visitante.gols&&a.mandante.gols>a.visitante.gols?1:0},l=function(a){return angular.extend(d(a.id),a),a.rodadas=[],a},d=function(a){var e=t.filter(function(e){return e.id===a?e:void 0});return e[0]},c=function(a,e){for(var t=0;t<e.length;t++)if(e[t].id===a)return e[t]};return{pegarBoleiros:function(){return a({method:"GET",url:i,cache:e,headers:{"X-Api-Secret":"xxx",Authorization:"xxx","Content-Type":"undefined"}}).then(function(a){t=a.data;var e=[];return angular.copy(t,e),e.filter(r).map(l)})},pegarRodada:function(a,e){var t=d(a);return c(e,t.rodadas)}}}]),angular.module("bolao").controller("ControlePrincipal",["$scope","BD",function(a,e){a.boleiros=[],e.pegarBoleiros().then(function(e){a.boleiros=e})}]),angular.module("bolao").run(["$templateCache",function(a){a.put("components/acordeon/diretivas/diretiva-acordeon.html",'<div class="acordeon" ng-transclude=""></div>'),a.put("components/acordeon/diretivas/diretiva-item.html",'<div class="item {{situacao}} {{tipo}}"><div class="item-cabecalho {{situacao}}" ng-click="abrir(indice)"><img ng-src="{{boleiro.foto}}"><div class="nome">{{boleiro.nome}}</div><div class="valores">Pontos<br>{{boleiro.pontos}}</div><div class="valores">Placares<br>{{boleiro.placares}}</div><div class="media">Média<br>pt: {{boleiro.mediaPontos | number:1}} pl: {{boleiro.mediaPlacares | number:1}}</div></div><div ng-transclude=""></div></div>'),a.put("components/carrossel/diretivas/diretiva-carrossel.html",'<div class="carrossel"><nav class="navegacao"><ul class="pontos"><li class="ponto" ng-class="{\'ativo\':ehPaginaAtual($index + 1)}" ng-repeat="pagina in (0|number:totalPaginas - 2 ) track by $index" ng-click="atualizarPagina($index + 1);">{{$index + 1}}</li></ul></nav><div ng-transclude="" class="paginas {{direcao}}"></div><a class="seta anterior" ng-click="paginaAnterior()"></a> <a class="seta proxima" ng-click="proximaPagina()"></a></div>'),a.put("components/carrossel/diretivas/diretiva-paginas.html",'<div class="pagina" ng-hide="!visivel"><div class="conteudo" ng-transclude="" ng-click="alternarDetalhe()"></div><div ng-click="alternarDetalhe()" class="detalhe" ng-class="{ocultar : !detalheVisivel}"><table class="detalhe-rodada"><tr><td class="cabecalho-detalhe-rodada" colspan="4">Detalhes da Rodada</td></tr><tr><td class="esquerda">Número:</td><td class="esquerda">{{conteudo.id}}</td><td class="esquerda">Total de Pontos:</td><td class="direita">{{conteudo.pontos}}</td></tr><tr><td class="esquerda">Data:</td><td class="esquerda">{{conteudo.data | date : \'dd/MM/yyyy\'}}</td><td class="esquerda">Total de Placares:</td><td class="direita">{{conteudo.Placares}}</td></tr></table></div></div>')}]);